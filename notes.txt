Basic ideas:

- archival system for photos, movies and other digital (or digitized) media
- base file, generated by the digitizing device, is never modified - treated as negative
  - may be dervied versions
- a photo or other recording is taken at a particular time in a particular place
  - nested map of (photographer/camera, time) -> place
  - display photos ordered by date by preference
  - multiple recordings from one event (eg, mpeg+still)
- maximize automatic extraction of metadata
  - use EXIF and other embedded metadata
  - time/place mapping
  - simplify addition of keywords to photos
  - automatic identification of photographer/rights holder/etc
- separate frontend and backend
  - commonly used via web interface
  - other more responsive UIs possible by sharing backend
  - RPC to hide underlying representation
- gallery arrangement/generation
  - secondary function
  - mostly functional with few frills
  - galleries the result of canned queries (even if the query just enumerates a list of photos)
  - either way, should be friendly to casual browsers
- access control
  - public/private
  - ACLs? groups?
- arrange photos into "collections"
  - multiple users/photo owners
- repeated importing without consequence
  - accumulate metadata?

Data design:

Table "media"

Stores all the bulk data, away from any metadata to keep cache footprint small.

      INT	mediaid				// unique media id (primary key)
      CHAR(40)	sha1hash			// index
      INT	chain		= "media"	// chain if too big for BLOB?
      LARGEBLOB	data

Table "images"

Per-image info.  XXX Split this into base info and per-media metadata?

      INT	imageid				// unique image id (primary key)
      CHAR	mimetype

      INT	mediaid		= "media"	// media
      INT	thumbid		= "media"	// thumbnail
      INT	link		= "images"	// related images

      INT	owner		= "users"
      ENUM	visibility(public,private)

      INT	rating				// photo rating (-ve = junk)
      CHAR	title
      CHAR	summary
      CHAR	description

      INT	cameraid	= "cameras"	// what took the image?

      INT	orientation			// which way is up?

      TIMEDATE	record_time			// time image recorded
      TIMEDATE	modified_time			// entry modified

      // Still photo metadata
      BOOL	flash				// flash used?
      CHAR	fstop				// aperature
      FLOAT	exposure_time			// shutter time
      INT	exposure_bias
      INT	brightness
      INT	focal_length
      // in-camera processing?      

      // mpeg metadata

Table "keyindex"
      INT	keyid				// unused ID
      INT	imageid		= "images"	// image id
      INT	keywordid	= "keywords"	// word ID

Table "keywords"
      INT	keywordid			// primary key
      CHAR	word				// keyword

Table "cameras"
      INT	cameraid

      CHAR	nickname
      CHAR	manuf
      CHAR	model
      CHAR	serial
      CHAR	notes

      INT	owner		= "users"

Table "users"
      INT	userid

      CHAR	username	// = email address
      CHAR	password
      CHAR	fullname

      BOOL	admin
      BOOL	viewall
